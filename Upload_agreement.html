<!DOCTYPE html>
<html>
<head>
    <title>Rental Agreement Portal</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .container { max-width: 600px; margin: auto; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
        
        /* Chat UI Styling */
        #chat-section { margin-top: 40px; border-top: 2px solid #eee; pt: 20px; }
        #chat-window { height: 250px; border: 1px solid #ccc; overflow-y: auto; padding: 15px; background: #f9f9f9; border-radius: 5px; margin-bottom: 10px; }
        .user-msg { color: #2c3e50; font-weight: bold; margin-bottom: 10px; }
        .ai-msg { color: #2980b9; margin-bottom: 15px; background: #eef6fc; padding: 8px; border-radius: 5px; }
        .loading { font-style: italic; color: #7f8c8d; }
        input[type="text"] { width: 75%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button.chat-btn { padding: 10px 15px; background-color: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>1. Upload Agreement PDF</h2>
    <input type="file" id="file" accept="application/pdf" />
    <button onclick="upload()">Upload</button>
    <br><br>
    <input type="email" id="email" placeholder="Enter your email" />
    <button onclick="submitForm()">Submit</button>
    <p id="status"></p>

    <div id="chat-section">
        <h2>2. Chat with your Agreement</h2>
        <div id="chat-window">
            <div class="ai-msg">Hello! I've read your agreement. Ask me anything about the rent, deposit, or rules.</div>
        </div>
        <input type="text" id="userQuestion" placeholder="Ask a question (e.g. How much is the rent?)" />
        <button class="chat-btn" onclick="askChatbot()">Ask</button>
    </div>
</div>

<script>
    // --- YOUR EXISTING UPLOAD LOGIC ---
    function upload() {
        const file = document.getElementById("file").files[0];
        const email = document.getElementById("email").value; 
        const reader = new FileReader();

        reader.onload = function () {
            const base64 = reader.result.split(",")[1];
            fetch("https://cjo6nwt50k.execute-api.eu-west-1.amazonaws.com/uploads", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    fileName: file.name,
                    fileContent: base64,
                    email: email
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("status").innerText = "Upload successful";
            })
            .catch(err => {
                document.getElementById("status").innerText = "Upload failed";
            });
        };
        reader.readAsDataURL(file);
    }

    // --- NEW CHATBOT LOGIC ---
    function askChatbot() {
        const questionInput = document.getElementById("userQuestion");
        const question = questionInput.value;
        const chatWindow = document.getElementById("chat-window");

        if (!question) return;

        // 1. Display User Question
        chatWindow.innerHTML += `<div class="user-msg">You: ${question}</div>`;
        
        // 2. Show Loading State
        const loadingId = "load-" + Date.now();
        chatWindow.innerHTML += `<div class="ai-msg loading" id="${loadingId}">AI is thinking...</div>`;
        questionInput.value = ""; // Clear input
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // 3. Call your API Gateway (We will get this URL in the next step)
        // REPLACE THE URL BELOW ONCE WE CREATE THE API GATEWAY
        fetch("https://lf229mmnf3.execute-api.eu-west-1.amazonaws.com/Test/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ "question": question })
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById(loadingId).remove(); // Remove loading text
            chatWindow.innerHTML += `<div class="ai-msg"><strong>AI:</strong> ${data.answer}</div>`;
            chatWindow.scrollTop = chatWindow.scrollHeight;
        })
        .catch(err => {
            document.getElementById(loadingId).innerText = "Error: Could not reach the AI.";
            console.error(err);
        });
    }
</script>

</body>
</html>

